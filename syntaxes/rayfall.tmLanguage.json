{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Rayfall",
  "scopeName": "source.rayfall",
  "patterns": [
    { "include": "#comment" },
    { "include": "#string" },
    { "include": "#quoted-symbol" },
    { "include": "#keyword-symbol" },
    { "include": "#null-literal" },
    { "include": "#infinity-nan" },
    { "include": "#guid-literal" },
    { "include": "#timestamp-literal" },
    { "include": "#date-literal" },
    { "include": "#time-literal" },
    { "include": "#hex-number" },
    { "include": "#float-number" },
    { "include": "#integer-number" },
    { "include": "#char-literal" },
    { "include": "#type-cast" },
    { "include": "#special-form" },
    { "include": "#query-keyword" },
    { "include": "#core-function" },
    { "include": "#builtin-constant" },
    { "include": "#special-variable" },
    { "include": "#function-call" },
    { "include": "#symbol-reference" },
    { "include": "#operator" },
    { "include": "#punctuation" }
  ],
  "repository": {
    "comment": {
      "patterns": [
        {
          "name": "comment.line.semicolon.rayfall",
          "match": ";.*$"
        }
      ]
    },
    "string": {
      "name": "string.quoted.double.rayfall",
      "begin": "\"",
      "end": "\"",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.string.begin.rayfall" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.string.end.rayfall" }
      },
      "patterns": [
        {
          "name": "constant.character.escape.rayfall",
          "match": "\\\\(?:[nrt\\\\\"']|[0-7]{3})"
        },
        {
          "name": "constant.other.placeholder.rayfall",
          "match": "%"
        }
      ]
    },
    "quoted-symbol": {
      "patterns": [
        {
          "name": "constant.other.symbol.quoted.rayfall",
          "match": "'[a-zA-Z_][a-zA-Z0-9_\\-?!.]*"
        }
      ]
    },
    "keyword-symbol": {
      "patterns": [
        {
          "name": "constant.other.keyword.rayfall",
          "match": ":[a-zA-Z_][a-zA-Z0-9_\\-?!]*"
        }
      ]
    },
    "null-literal": {
      "patterns": [
        {
          "name": "constant.language.null.rayfall",
          "match": "\\b0N[0hditplgsfp]\\b|\\b::?\\b|\\bnil\\b"
        }
      ]
    },
    "infinity-nan": {
      "patterns": [
        {
          "name": "constant.language.infinity.rayfall",
          "match": "-?0[wW]"
        },
        {
          "name": "constant.language.nan.rayfall",
          "match": "\\b0[nN]\\b"
        }
      ]
    },
    "guid-literal": {
      "name": "constant.other.guid.rayfall",
      "match": "[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}"
    },
    "timestamp-literal": {
      "name": "constant.other.timestamp.rayfall",
      "match": "\\d{4}\\.\\d{2}\\.\\d{2}[DT]\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?"
    },
    "date-literal": {
      "name": "constant.other.date.rayfall",
      "match": "\\d{4}\\.\\d{2}\\.\\d{2}(?![DT])"
    },
    "time-literal": {
      "name": "constant.other.time.rayfall",
      "match": "-?\\d{1,2}:\\d{2}:\\d{2}(?:\\.\\d+)?"
    },
    "hex-number": {
      "name": "constant.numeric.hex.rayfall",
      "match": "0x[0-9a-fA-F]+"
    },
    "float-number": {
      "name": "constant.numeric.float.rayfall",
      "match": "-?\\d+\\.\\d+(?:[eE][+-]?\\d+)?[fF]?"
    },
    "integer-number": {
      "name": "constant.numeric.integer.rayfall",
      "match": "-?\\d+[iIjJhHbBlL]?"
    },
    "char-literal": {
      "name": "constant.character.rayfall",
      "match": "'(?:\\\\[nrt\\\\'0-7]|[^'])'"
    },
    "type-cast": {
      "patterns": [
        {
          "name": "storage.type.rayfall",
          "match": "\\b(Timestamp|String|F64|I64|Bool|Symbol|Time|Date|Guid|Char|I32|F32|U64|U32|I16|U16|I8|U8|B8|C8|List|Table|Dict|Lambda)\\b"
        }
      ]
    },
    "special-form": {
      "patterns": [
        {
          "match": "(?<=\\()\\s*(fn|do|let|if|cond|when|unless|set|try|catch|return|exit|raise|throw|quote|and|or|def|defn|loop|recur)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "keyword.control.rayfall" }
          }
        }
      ]
    },
    "query-keyword": {
      "patterns": [
        {
          "match": "(?<=\\()\\s*(select|update|delete|insert|upsert|alter|modify)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "keyword.other.dml.rayfall" }
          }
        },
        {
          "name": "keyword.other.clause.rayfall",
          "match": "\\b(from|where|by|take|into|as)(?=\\s*:)"
        }
      ]
    },
    "core-function": {
      "patterns": [
        {
          "comment": "Collection functions",
          "match": "(?<=\\()\\s*(list|enlist|table|dict|first|last|count|reverse|distinct|raze|concat|remove|filter|take|drop|til|row|key|value|keys|values|flip|get|at|in|within|sect|except|union|find|group|ungroup|enum|xbar|split|bin|binr)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.collection.rayfall" }
          }
        },
        {
          "comment": "Aggregation functions",
          "match": "(?<=\\()\\s*(sum|avg|med|dev|var|min|max|count|all|any|prod|wavg|wsum|cov|cor|first|last|sums|prds|mins|maxs|avgs|msum|mcount|mavg|mmin|mmax)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.aggregate.rayfall" }
          }
        },
        {
          "comment": "Math functions",
          "match": "(?<=\\()\\s*(abs|neg|floor|ceil|round|sqrt|exp|log|sin|cos|tan|asin|acos|atan|signum|mod|div|reciprocal)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.math.rayfall" }
          }
        },
        {
          "comment": "Order/Sort functions",
          "match": "(?<=\\()\\s*(asc|desc|iasc|idesc|rank|xasc|xdesc|xrank|sort)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.order.rayfall" }
          }
        },
        {
          "comment": "Higher-order functions",
          "match": "(?<=\\()\\s*(apply|map|pmap|fold|scan|map-left|map-right|fold-left|fold-right|scan-left|scan-right|each|peach|over|converge)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.higher-order.rayfall" }
          }
        },
        {
          "comment": "Join functions",
          "match": "(?<=\\()\\s*(left-join|inner-join|asof-join|window-join|lj|ij|aj|wj|uj|pj)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.join.rayfall" }
          }
        },
        {
          "comment": "IO functions",
          "match": "(?<=\\()\\s*(read|write|read-csv|write-csv|hopen|hclose|load|save|set-splayed|get-splayed|set-parted|get-parted|system)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.io.rayfall" }
          }
        },
        {
          "comment": "Type/Meta functions",
          "match": "(?<=\\()\\s*(type|meta|parse|eval|format|show|print|println|ser|de|resolve|nil\\?|null\\?|empty\\?|atom\\?|list\\?)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.meta.rayfall" }
          }
        },
        {
          "comment": "Date/Time functions",
          "match": "(?<=\\()\\s*(date|time|timestamp|guid|year|month|mm|dd|hh|mi|ss|ms)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.datetime.rayfall" }
          }
        },
        {
          "comment": "String functions",
          "match": "(?<=\\()\\s*(lower|upper|trim|ltrim|rtrim|like|ss|ssr|vs|sv)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.string.rayfall" }
          }
        },
        {
          "comment": "Random functions",
          "match": "(?<=\\()\\s*(rand|deal|roll)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.random.rayfall" }
          }
        },
        {
          "comment": "System functions",
          "match": "(?<=\\()\\s*(env|gc|args|timer|sysinfo|memstat|timeit|loadfn|internals)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.system.rayfall" }
          }
        },
        {
          "comment": "Logic functions",
          "match": "(?<=\\()\\s*(not|unify|diverse)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "support.function.logic.rayfall" }
          }
        }
      ]
    },
    "builtin-constant": {
      "patterns": [
        {
          "name": "constant.language.boolean.rayfall",
          "match": "\\b(true|false)\\b"
        }
      ]
    },
    "special-variable": {
      "patterns": [
        {
          "name": "variable.language.self.rayfall",
          "match": "\\bself\\b"
        },
        {
          "name": "variable.language.it.rayfall",
          "match": "\\bit\\b"
        },
        {
          "name": "variable.other.global.rayfall",
          "match": "\\.[a-zA-Z_][a-zA-Z0-9_\\-?!.]*"
        }
      ]
    },
    "function-call": {
      "patterns": [
        {
          "match": "(?<=\\()\\s*([a-zA-Z_][a-zA-Z0-9_\\-?!]*)(?=\\s|\\)|$)",
          "captures": {
            "1": { "name": "entity.name.function.rayfall" }
          }
        }
      ]
    },
    "symbol-reference": {
      "patterns": [
        {
          "name": "variable.other.rayfall",
          "match": "\\b[a-zA-Z_][a-zA-Z0-9_\\-?!]*\\b"
        }
      ]
    },
    "operator": {
      "patterns": [
        {
          "name": "keyword.operator.comparison.rayfall",
          "match": "==|!=|<>|<=|>=|<|>"
        },
        {
          "name": "keyword.operator.arithmetic.rayfall",
          "match": "[+\\-*/%]"
        },
        {
          "name": "keyword.operator.logical.rayfall",
          "match": "[&|!~^]"
        },
        {
          "name": "keyword.operator.assignment.rayfall",
          "match": ":"
        },
        {
          "name": "keyword.operator.dict.rayfall",
          "match": "!"
        },
        {
          "name": "keyword.operator.apply.rayfall",
          "match": "@"
        },
        {
          "name": "keyword.operator.compose.rayfall",
          "match": "\\."
        },
        {
          "name": "keyword.operator.project.rayfall",
          "match": "#"
        },
        {
          "name": "keyword.operator.question.rayfall",
          "match": "\\?"
        },
        {
          "name": "keyword.operator.each.rayfall",
          "match": "'"
        },
        {
          "name": "keyword.operator.underscore.rayfall",
          "match": "_"
        },
        {
          "name": "keyword.operator.dollar.rayfall",
          "match": "\\$"
        }
      ]
    },
    "punctuation": {
      "patterns": [
        {
          "name": "punctuation.section.parens.begin.rayfall",
          "match": "\\("
        },
        {
          "name": "punctuation.section.parens.end.rayfall",
          "match": "\\)"
        },
        {
          "name": "punctuation.section.brackets.begin.rayfall",
          "match": "\\["
        },
        {
          "name": "punctuation.section.brackets.end.rayfall",
          "match": "\\]"
        },
        {
          "name": "punctuation.section.braces.begin.rayfall",
          "match": "\\{"
        },
        {
          "name": "punctuation.section.braces.end.rayfall",
          "match": "\\}"
        },
        {
          "name": "punctuation.separator.rayfall",
          "match": "[;,]"
        }
      ]
    }
  }
}


